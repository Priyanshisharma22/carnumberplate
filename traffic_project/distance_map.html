<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Zoomable Traffic Phase Map</title>
<style>
  html, body {
    margin: 0; padding: 0; overflow: hidden;
    background: #0d1117; color: #eaeef2; font-family: Arial, sans-serif;
  }
  canvas {
    width: 100vw; height: 100vh; display: block; cursor: grab;
  }
  #toolbar {
    position: absolute; top: 12px; left: 12px; background: #161b22;
    border: 1px solid #30363d; border-radius: 8px; padding: 8px;
  }
  #toolbar button {
    background: #238636; color: white; border: none; border-radius: 6px;
    margin: 2px; padding: 6px 10px; cursor: pointer;
  }
  #toolbar button:hover { background: #2ea043; }
  #toolbar label { margin-left: 8px; font-size: 13px; color: #ddd; }
</style>
</head>
<body>
<canvas id="canvas"></canvas>

<div id="toolbar">
  <button id="zoomIn">Ôºã</button>
  <button id="zoomOut">Ôºç</button>
  <button id="reset">Reset</button>
  <button id="randomize">üé≤ Randomize</button>
  <label><input type="checkbox" id="lockP12" checked> Lock P1‚ÄìP2 = 4 km</label>
</div>

<script>
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");

// World coordinates (same as Python grid)
const WIDTH = 1920, HEIGHT = 1080;
const X1 = WIDTH/3, X2 = WIDTH*2/3;
const Y1 = HEIGHT/3, Y2 = HEIGHT*2/3;
const INTER_SIZE = 120, INTER_HALF = INTER_SIZE/2;

const PHASES = [
  { label: "Phase 1", x: X1, y: Y1 },
  { label: "Phase 2", x: X2, y: Y1 },
  { label: "Phase 3", x: X1, y: Y2 },
  { label: "Phase 4", x: X2, y: Y2 }
];

const EDGES = [
  { a: 0, b: 1, key: "P1‚ÄìP2" },
  { a: 2, b: 3, key: "P3‚ÄìP4" },
  { a: 0, b: 2, key: "P1‚ÄìP3" },
  { a: 1, b: 3, key: "P2‚ÄìP4" }
];

// Distances (km)
let dist = {
  "P1‚ÄìP2": 4.0,
  "P3‚ÄìP4": rand(),
  "P1‚ÄìP3": rand(),
  "P2‚ÄìP4": rand()
};

// Zoom and pan
let scale = 0.5;
let offsetX = 0, offsetY = 0;
let dragging = false, lastX = 0, lastY = 0;

// Resize canvas to window
function resize() {
  canvas.width = innerWidth;
  canvas.height = innerHeight;
  draw();
}
window.addEventListener("resize", resize);
resize();

// Mouse controls for panning
canvas.addEventListener("mousedown", e => {
  dragging = true;
  lastX = e.clientX; lastY = e.clientY;
  canvas.style.cursor = "grabbing";
});
window.addEventListener("mouseup", () => {
  dragging = false;
  canvas.style.cursor = "grab";
});
window.addEventListener("mousemove", e => {
  if (!dragging) return;
  offsetX += e.clientX - lastX;
  offsetY += e.clientY - lastY;
  lastX = e.clientX; lastY = e.clientY;
  draw();
});

// Scroll zoom
canvas.addEventListener("wheel", e => {
  e.preventDefault();
  const zoomFactor = e.deltaY < 0 ? 1.1 : 0.9;
  scale = Math.min(3, Math.max(0.2, scale * zoomFactor));
  draw();
});

// Toolbar buttons
document.getElementById("zoomIn").onclick = () => { scale = Math.min(scale * 1.2, 3); draw(); };
document.getElementById("zoomOut").onclick = () => { scale = Math.max(scale / 1.2, 0.2); draw(); };
document.getElementById("reset").onclick = () => { scale = 0.5; offsetX = 0; offsetY = 0; draw(); };
document.getElementById("randomize").onclick = randomizeDistances;

function rand() { return +(Math.random() * 9 + 1).toFixed(1); }

function randomizeDistances() {
  EDGES.forEach(e => {
    if (e.key === "P1‚ÄìP2" && document.getElementById("lockP12").checked) {
      dist[e.key] = 4.0;
    } else {
      dist[e.key] = rand();
    }
  });
  draw();
}

// Convert world coords to screen coords
function worldToScreen(x, y) {
  return [
    (x - WIDTH / 2) * scale + canvas.width / 2 + offsetX,
    (y - HEIGHT / 2) * scale + canvas.height / 2 + offsetY
  ];
}

// Draw everything
function draw() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  ctx.fillStyle = "#0d1117";
  ctx.fillRect(0, 0, canvas.width, canvas.height);

  ctx.save();
  ctx.translate(canvas.width / 2 + offsetX, canvas.height / 2 + offsetY);
  ctx.scale(scale, scale);
  ctx.translate(-WIDTH / 2, -HEIGHT / 2);

  // Roads
  ctx.fillStyle = "#111";
  const ROAD = 60;
  ctx.fillRect(0, Y1 - ROAD/2, WIDTH, ROAD);
  ctx.fillRect(0, Y2 - ROAD/2, WIDTH, ROAD);
  ctx.fillRect(X1 - ROAD/2, 0, ROAD, HEIGHT);
  ctx.fillRect(X2 - ROAD/2, 0, ROAD, HEIGHT);

  // Intersections
  PHASES.forEach(p => {
    ctx.fillStyle = "#c33";
    ctx.fillRect(p.x - INTER_HALF, p.y - INTER_HALF, INTER_SIZE, INTER_SIZE);
    ctx.fillStyle = "yellow";
    ctx.font = "24px Arial";
    ctx.textAlign = "center";
    ctx.textBaseline = "middle";
    ctx.fillText(p.label, p.x, p.y);
  });

  // Distance lines
  ctx.strokeStyle = "#1e90ff";
  ctx.lineWidth = 3;
  EDGES.forEach(e => {
    const A = PHASES[e.a], B = PHASES[e.b];
    ctx.beginPath();
    ctx.moveTo(A.x, A.y);
    ctx.lineTo(B.x, B.y);
    ctx.stroke();
    const mx = (A.x + B.x)/2, my = (A.y + B.y)/2;
    ctx.fillStyle = "#80c0ff";
    ctx.font = "20px Arial";
    ctx.textAlign = "center";
    ctx.fillText(`${dist[e.key]} km`, mx, my - 10);
  });

  ctx.restore();
}
draw();
</script>
</body>
</html>
